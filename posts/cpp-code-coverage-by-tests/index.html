<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>C++ code coverage by tests | Povilas Blog</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="http://blog.povilasb.com/posts/cpp-code-coverage-by-tests/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Povilas Balciunas">
<link rel="prev" href="../showterm-server-installation/" title="Showterm server installation (Debian, Nginx, PostgreSQL)" type="text/html">
<link rel="next" href="../boost-deps-analyzer/" title="Boost dependency analyzer" type="text/html">
<meta property="og:site_name" content="Povilas Blog">
<meta property="og:title" content="C++ code coverage by tests">
<meta property="og:url" content="http://blog.povilasb.com/posts/cpp-code-coverage-by-tests/">
<meta property="og:description" content="Code coverage by tests
We will continue on unit testing the code. But this time I'll show you how to
check which part of code is covered by tests and which is not. Such
information becomes useful when">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2014-11-04T21:52:00-02:00">
<meta property="article:tag" content="cpp">
<meta property="article:tag" content="testing">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../">

            <span id="blog-title">Povilas Blog</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.rst" id="sourcelink" class="nav-link">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">C++ code coverage by tests</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Povilas Balciunas
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2014-11-04T21:52:00-02:00" itemprop="datePublished" title="2014-11-04 21:52">2014-11-04 21:52</time></a>
            </p>
                <p class="commentline">    

                    </p>
<p class="sourceline"><a href="index.rst" class="sourcelink">Source</a></p>

        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <section id="code-coverage-by-tests"><h2>Code coverage by tests</h2>
<p>We will continue on unit testing the code. But this time I'll show you how to
check which part of code is covered by tests and which is not. Such
information becomes useful when analyzing how well your code is tested. And
the more code is tested, the more stable it can be considered.</p>
<p>In computer science, code coverage is a measure used to describe the degree to
which the source code of a program is tested by a particular test suite. A
program with high code coverage has been more thoroughly tested and has a
lower chance of containing software bugs than a program with low code coverage.</p>
<section id="setup-environment"><h3>Setup environment</h3>
<p>Prerequisites:</p>
<ul class="simple">
<li><p>GNU g++ compiler</p></li>
<li><p>lcov (<a class="reference external" href="http://ltp.sourceforge.net/coverage/lcov.php">http://ltp.sourceforge.net/coverage/lcov.php</a>)</p></li>
<li><p>CMake, make</p></li>
</ul>
<p>These tools are all available on linux systems. On Debian:</p>
<div class="code"><pre class="code bash"><a id="rest_code_208645b0af7f413fac43a9b8e30add54-1" name="rest_code_208645b0af7f413fac43a9b8e30add54-1" href="#rest_code_208645b0af7f413fac43a9b8e30add54-1"></a>$ sudo apt-get install g++ lcov cmake make
</pre></div>
</section><section id="create-sample-project"><h3>Create sample project</h3>
<p>You can get a sample from github:</p>
<div class="code"><pre class="code bash"><a id="rest_code_9d318df350ed4352b51c18e173c633a0-1" name="rest_code_9d318df350ed4352b51c18e173c633a0-1" href="#rest_code_9d318df350ed4352b51c18e173c633a0-1"></a>$ git clone https://github.com/povilasb-com/cpp-code-coverage.git
</pre></div>
<p>We'll use the same project structure as in
<a class="reference external" href="../cpp-googletest-intro/">C++ unit tests with googletest</a>:</p>
<pre class="literal-block">.
|__ googletest-cmake
  |__ lib
  | |__ googletest -&gt; ~/dev-tools/gtest-1.7.0
  |__ src
  | |__ lib1.cpp
  | |__ lib1.hpp
  |__ test
  | |__ lib1_test.cpp
  |__ CMakeLists.txt
  |__ Makefile</pre>
<p>But this time i'm not going to describe how to create the project itself, you
can get it from github.</p>
<p>Although there are few differences in build scripts compared to
<a class="reference external" href="../cpp-googletest-intro/">C++ unit tests with googletest</a> that I would like to
mention:</p>
<section id="cmakelists-txt"><h4>CMakeLists.txt</h4>
<div class="code"><pre class="code cmake"><a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-1" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-1" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-1"></a><span class="nb">cmake_minimum_required</span> <span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">2.6</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-2" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-2" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-2"></a><span class="nb">project</span> <span class="p">(</span><span class="s">Lib1</span><span class="w"> </span><span class="s">CXX</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-3" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-3" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-3"></a>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-4" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-4" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-4"></a>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-5" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-5" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-5"></a><span class="nb">set</span> <span class="p">(</span><span class="s">CMAKE_CXX_FLAGS</span><span class="w"> </span><span class="s2">"-ggdb -fprofile-arcs -ftest-coverage"</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-6" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-6" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-6"></a><span class="nb">set</span> <span class="p">(</span><span class="s">CMAKE_EXE_LINKER_FLAGS</span><span class="w"> </span><span class="s2">"-fprofile-arcs -ftest-coverage"</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-7" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-7" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-7"></a>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-8" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-8" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-8"></a>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-9" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-9" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-9"></a><span class="nb">set</span> <span class="p">(</span><span class="s">SRC_DIR</span><span class="w"> </span><span class="s2">"${CMAKE_CURRENT_SOURCE_DIR}/src"</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-10" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-10" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-10"></a><span class="nb">include_directories</span> <span class="p">(</span><span class="s2">"${SRC_DIR}"</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-11" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-11" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-11"></a>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-12" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-12" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-12"></a><span class="nb">file</span> <span class="p">(</span><span class="s">GLOB_RECURSE</span><span class="w"> </span><span class="s">SRC_FILES</span><span class="w"> </span><span class="s2">"${SRC_DIR}/*.cpp"</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-13" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-13" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-13"></a>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-14" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-14" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-14"></a>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-15" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-15" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-15"></a><span class="c"># Compiles static lib that will be linked with tests.</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-16" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-16" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-16"></a><span class="nb">set</span> <span class="p">(</span><span class="s">LIB_NAME</span><span class="w"> </span><span class="s2">"lib1"</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-17" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-17" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-17"></a><span class="nb">add_library</span> <span class="p">(</span><span class="s2">"${LIB_NAME}"</span><span class="w"> </span><span class="s">STATIC</span><span class="w"> </span><span class="o">${</span><span class="nv">SRC_FILES</span><span class="o">}</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-18" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-18" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-18"></a>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-19" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-19" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-19"></a>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-20" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-20" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-20"></a><span class="c"># Include googletest.</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-21" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-21" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-21"></a><span class="nb">set</span> <span class="p">(</span><span class="s">GTEST_DIR</span><span class="w"> </span><span class="s2">"${CMAKE_CURRENT_SOURCE_DIR}/lib/googletest"</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-22" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-22" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-22"></a><span class="nb">add_subdirectory</span> <span class="p">(</span><span class="o">${</span><span class="nv">GTEST_DIR</span><span class="o">}</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-23" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-23" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-23"></a><span class="nb">include_directories</span> <span class="p">(</span><span class="s2">"${GTEST_DIR}/include"</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-24" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-24" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-24"></a>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-25" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-25" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-25"></a>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-26" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-26" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-26"></a><span class="c"># Build tests executable.</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-27" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-27" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-27"></a><span class="nb">set</span> <span class="p">(</span><span class="s">TEST_EXEC</span><span class="w"> </span><span class="s2">"${LIB_NAME}_test"</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-28" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-28" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-28"></a><span class="nb">set</span> <span class="p">(</span><span class="s">TEST_SRC_DIR</span><span class="w"> </span><span class="s2">"${CMAKE_CURRENT_SOURCE_DIR}/test"</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-29" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-29" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-29"></a><span class="nb">file</span> <span class="p">(</span><span class="s">GLOB_RECURSE</span><span class="w"> </span><span class="s">TEST_SRC_FILES</span><span class="w"> </span><span class="s2">"${TEST_SRC_DIR}/*.cpp"</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-30" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-30" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-30"></a>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-31" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-31" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-31"></a>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-32" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-32" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-32"></a><span class="nb">add_executable</span> <span class="p">(</span><span class="s2">"${TEST_EXEC}"</span><span class="w"> </span><span class="o">${</span><span class="nv">TEST_SRC_FILES</span><span class="o">}</span><span class="p">)</span>
<a id="rest_code_c6eb48c8f39b465d86718c9f33ecf658-33" name="rest_code_c6eb48c8f39b465d86718c9f33ecf658-33" href="#rest_code_c6eb48c8f39b465d86718c9f33ecf658-33"></a><span class="nb">target_link_libraries</span> <span class="p">(</span><span class="s2">"${TEST_EXEC}"</span><span class="w"> </span><span class="s2">"${LIB_NAME}"</span><span class="w"> </span><span class="s2">"gtest"</span><span class="w"> </span><span class="s2">"gtest_main"</span><span class="p">)</span>
</pre></div>
<p>This CMake sets specific compiler (CMAKE_CXX_FLAGS) and linker
(CMAKE_EXE_LINKER_FLAGS) flags "-fprofile-arcs" and "-ftest-coverage".</p>
<p>When these flags are set, compiler injects profiling code that collects data
about program execution: e.g. which line how much times was executed.</p>
</section><section id="makefile"><h4>Makefile</h4>
<div class="code"><pre class="code make"><a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-1" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-1" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-1"></a><span class="nv">BUILD_DIR</span> <span class="o">=</span> build
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-2" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-2" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-2"></a>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-3" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-3" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-3"></a><span class="nf">all</span><span class="o">:</span> <span class="n">test</span> <span class="n">test</span>-<span class="n">run</span> <span class="n">coverage</span>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-4" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-4" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-4"></a>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-5" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-5" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-5"></a><span class="nf">test</span><span class="o">:</span> <span class="k">$(</span><span class="nv">BUILD_DIR</span><span class="k">)</span>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-6" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-6" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-6"></a>        <span class="nb">cd</span> <span class="k">$(</span>BUILD_DIR<span class="k">)</span><span class="p">;</span> cmake <span class="k">$(</span>CURDIR<span class="k">)</span><span class="p">;</span> make
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-7" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-7" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-7"></a>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-8" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-8" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-8"></a><span class="nf">test-run</span><span class="o">:</span>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-9" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-9" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-9"></a>        <span class="k">$(</span>BUILD_DIR<span class="k">)</span>/lib1_test
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-10" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-10" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-10"></a>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-11" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-11" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-11"></a><span class="nf">coverage</span><span class="o">:</span>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-12" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-12" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-12"></a>        lcov --capture --directory <span class="k">$(</span>BUILD_DIR<span class="k">)</span> <span class="se">\</span>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-13" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-13" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-13"></a>                --output-file <span class="k">$(</span>BUILD_DIR<span class="k">)</span>/coverage.info
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-14" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-14" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-14"></a>        genhtml <span class="k">$(</span>BUILD_DIR<span class="k">)</span>/coverage.info <span class="se">\</span>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-15" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-15" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-15"></a>                --output-directory <span class="k">$(</span>BUILD_DIR<span class="k">)</span>/coverage-report
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-16" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-16" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-16"></a>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-17" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-17" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-17"></a><span class="nf">$(BUILD_DIR)</span><span class="o">:</span>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-18" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-18" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-18"></a>        mkdir -p <span class="nv">$@</span>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-19" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-19" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-19"></a>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-20" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-20" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-20"></a><span class="nf">clean</span><span class="o">:</span>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-21" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-21" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-21"></a>        rm -rf <span class="k">$(</span>BUILD_DIR<span class="k">)</span>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-22" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-22" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-22"></a>
<a id="rest_code_d89a6da5e3554bcfa0860dcea8666339-23" name="rest_code_d89a6da5e3554bcfa0860dcea8666339-23" href="#rest_code_d89a6da5e3554bcfa0860dcea8666339-23"></a><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">all</span> <span class="n">cmake</span> <span class="n">clean</span> <span class="n">coverage</span> <span class="n">test</span> <span class="n">test</span>-<span class="n">run</span>
</pre></div>
<p>This Makefile compared to unit test project Makefile contains target "coverage".
This target runs lcov command that collects coverage data and generates HTML
output.</p>
</section></section><section id="compile-run-tests-and-build-coverage-report"><h3>Compile, run tests and build coverage report</h3>
<p>All thsese steps are programmed in Makefile script, so simply invoke "make".</p>
<p>As a result it will</p>
<ul class="simple">
<li><p>build tests in build directory;</p></li>
<li><p>run tests executable;</p></li>
<li><p>this executable will generate *.gcda and *.gcno files, which contain code
execution information. Do not worry about these files, lcov tool will take
care of them for us.</p></li>
<li><p>And finally it will run lcov tool that locates and
parses execution data automatically for us and creates html output.</p></li>
</ul>
<p>You can see the results in
<a class="reference external" href="../_static/samples/cpp/code-coverage/index.html">here</a>.</p>
</section><section id="analysis-report"><h3>Analysis report</h3>
<img alt="/images/lcov_main.png" class="align-center" src="../../images/lcov_main.png" style="width: 100%;"><p>In our sample code coverage by tests report is built in
"./build/coverage-report". This directory contains "index.html". Simply open it
in your web browser and you should be all set.</p>
<p>Do not worry if you see a lot of source files indicated by red color. This
actually means that only a small part of this code was executed. But mostly
these files are c++ standard libraries.</p>
<p>Simply navigate to src/lib1.cpp - this is the source file we were testing and
we are interested in how many lines of this file our tests executed.</p>
</section><section id="analyzing-our-library-sources"><h3>Analyzing our library sources</h3>
<img alt="/images/lcov_lib1.png" class="align-center" src="../../images/lcov_lib1.png" style="width: 100%;"><p>Analyzing further you'll see that the situation is not that bad.</p>
<p>Our sample tests cover 66% of lib1.cpp code. And this report show which lines
in code were executed and which were not. So based on these results you can
supplement your test cases.</p>
<p class="rubric">References</p>
<aside class="footnote-list brackets"><aside class="footnote brackets" id="f1" role="note"><span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://gcc.gnu.org/onlinedocs/gcc/Gcov.html">http://gcc.gnu.org/onlinedocs/gcc/Gcov.html</a></p>
</aside><aside class="footnote brackets" id="f2" role="note"><span class="label"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://ltp.sourceforge.net/coverage/lcov.php">http://ltp.sourceforge.net/coverage/lcov.php</a></p>
</aside></aside></section></section>
</div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/cpp/" rel="tag">cpp</a></li>
            <li><a class="tag p-category" href="../../categories/testing/" rel="tag">testing</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../showterm-server-installation/" rel="prev" title="Showterm server installation (Debian, Nginx, PostgreSQL)">Previous post</a>
            </li>
            <li class="next">
                <a href="../boost-deps-analyzer/" rel="next" title="Boost dependency analyzer">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
            

        </section></article><!--End of body content--><footer id="footer">
            Contents © 2022         <a href="mailto:balciunas90@gmail.com">Povilas Balciunas</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>

        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
